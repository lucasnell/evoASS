---
title: "Alternative stable states simulations"
author: "Lucas A. Nell"
date: "10/25/2018"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Alternative stable states simulations}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev = "svglite", 
  fig.width = 6,
  fig.height = 4,
  echo = FALSE
)
knitr::opts_knit$set(root.dir = normalizePath(".."))
options(tibble.print_min = 4L, tibble.print_max = 8L)
```
```{r source_Rprofile, echo = FALSE}
if (!isTRUE(getOption('knitr.in.progress'))) source(".Rprofile")
suppressPackageStartupMessages({
    library(tidyverse)
    library(evoASS)
})
```


```{r adaptive_dynamics}

set.seed(4)
ad_sims <- adapt_dyn(
        V0 = c(1, 1),
        N0 = 1,
        f = 0.1,  # cost of the trait on the growth rate
        g = 0.5,  # benefit of the trait on density dependence
        eta = 0.05 * 1,  # 0.2,  # the non-additive effects of traits on `r`
        d = -0.001,  # changes how the focal line is affected by other lines' trait values
        max_t = 1e4)



# ad_sims %>% .[["data"]] %>% 
#     group_by(time) %>% 
#     summarize(N = n()) %>% 
#     ungroup() %>% 
#     ggplot(aes(time, N)) +
#     geom_line()

ad_sims %>%
    .[["data"]] %>% 
    ggplot(aes(time, value, color = trait)) +
    geom_point(shape = 1, alpha = 0.5) +
    scale_color_manual(values = c("dodgerblue3", "firebrick3")) +
    ylab("Trait value") +
    xlab("Time")



set.seed(5)
perterb_plot <- ad_sims %>%
    add_perterbation(new_prop = 5,
                     new_trait_means = c(0, 0),
                     new_trait_sigmas = rep(0.25, 2),
                     new_N_mean = 10, new_N_sd = 5) %>%
    add_perterbation(new_prop = 5,
                     new_trait_means = c(1.2, -1.6),
                     new_trait_sigmas = rep(0.25, 2),
                     new_N_mean = 100, new_N_sd = 5) %>%
    .[["data"]] %>%
    ggplot(aes(time, value, color = trait)) +
    geom_vline(xintercept = c(1e4, 2e4), linetype = 2, color = "gray80") +
    geom_point(shape = 1, alpha = 0.5, size = 0.25) +
    scale_color_manual(values = c("dodgerblue3", "firebrick3")) +
    theme(legend.position = c(0.9, 0.5)) +
    guides(color = guide_legend("Trait:", override.aes = list(size = 2, alpha = 1))) +
    ylab("Trait value") +
    xlab("Time")

perterb_plot <- perterb_plot +
    theme(axis.title = element_blank(),
          axis.ticks = element_blank(),
          axis.text = element_blank(),
          legend.position = "none")

perterb_plot

# ggsave(perterb_plot, filename = "perterb_p.pdf", width = 6.5, height = 4)




ad_sims %>% .[["data"]] %>% 
    group_by(time) %>% 
    summarize(N = sum(N)) %>% 
    ungroup() %>% 
    ggplot(aes(time, N)) +
    geom_line() +
    theme_classic()



```




